<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>Gone Fishing</title>
  <!-- <link rel="stylesheet" type="text/css" media="screen" href="css/master.css" /> -->
  <script type="text/javascript" src="/jquery-1.4.4.min.js"></script>
  <script type="text/javascript" src="/jquery-ui-1.8.7.min.js"></script>
  <script>
    $(function() {
      var mark_vacation = function(fn) {
        return function() {
          fn.apply(this, arguments);
          update_count();
        }
      };
      var highlight_between_ids = function(from, to) {
        sorted_ids = [parseInt(from, 10), parseInt(to, 10)].sort();
        for(id = sorted_ids[0]; id <= sorted_ids[1]; id += 1) {
          $("#"+id).addClass("vacation");
        }
      };
      var update_count = function() {
        $("#count").text($(".vacation").not(".weekend").length);
      };
      var dragging;
      $("td").draggable({
        opacity: 0.7,
        helper: "clone",
        start: function(event, ui) {
          dragging = $(this);
        }
      });
      $("td").droppable({
          hoverClass: 'drophover',
          over: mark_vacation(function() {
            highlight_between_ids($(".drophover").attr("id"), $(dragging).attr("id"));
          })
      });
      $("td").click(mark_vacation(function() {
        $(this).toggleClass("vacation");
      }));
    });
  </script>
  <style type="text/css">
    td { text-align:center; padding: 5px 8px; margin:0; cursor: default; width:20px; float:left; }
    .weekend { background-color:#F8B85F; }
    .vacation { background-color:red; !important }
    #count { margin-top:50px; clear: left; font-size:6em; font-family: Helvetica, Arial, 'sans-serif'}
    tr { list-style-type:none; clear: left; border-top: 1px solid #000; padding:0; margin:0; }
    table { margin: 0 auto; }
  </style>
</head>
<body>
  <%= calendar_for(Time.now.year) %>
  <div id="count"></div>
</body>
</html>